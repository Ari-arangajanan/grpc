package org.example.grpc;import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;import com.devProblems.AgentChoreReq;import com.devProblems.AgentChoreRes;import com.devProblems.AgentChoreServiceGrpc;import io.grpc.stub.StreamObserver;import net.devh.boot.grpc.server.service.GrpcService;import org.apache.rocketmq.spring.core.RocketMQTemplate;import org.example.commonModels.AgentChore;import org.example.commonModels.UserChore;import org.example.repository.AgentChoreDao;@GrpcServicepublic class AgentChoreGrpcServer extends AgentChoreServiceGrpc.AgentChoreServiceImplBase {    private final AgentChoreDao agentChoreDao;    private final RocketMQTemplate rocketMQTemplate;    public AgentChoreGrpcServer(AgentChoreDao agentChoreDao, RocketMQTemplate rocketMQTemplate) {        this.agentChoreDao = agentChoreDao;        this.rocketMQTemplate = rocketMQTemplate;    }    @Override    public void agentSave(AgentChoreReq request, StreamObserver<AgentChoreRes> responseObserver) {        AgentChore agentChore = new AgentChore();        agentChore.setName(request.getName());        agentChore.setRollbackId(request.getRollbackId());        try {            agentChoreDao.insert(agentChore);            rocketMQTemplate.convertAndSend("AgentTopic", agentChore);        }catch (RuntimeException e){            rollbackAgent(agentChore.getRollbackId());            UserChore user = new UserChore();            rocketMQTemplate.convertAndSend("UserRollbackTopic", user);            throw e;        }    }    // this for compensation    public void rollbackAgent(String rollbackId) {        agentChoreDao.delete(new QueryWrapper<AgentChore>().eq("rollbackId", rollbackId));    }}